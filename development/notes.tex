\section{Development - 31/03/2019}
I have decided to pursue the 'Ethernet' approach, which is to use an \ac{SFP}
module, the same as all the other \ac{FSO} approaches do. The idea will be
to break out an \ac{SFP} module using a breakout board so that the laser
and photodiode can be attached. This should then be able to drive the system
much higher and provide a much faster link (gigabit).

The \ac{SFP} specification can be found here:
\url{http://www.kt.agh.edu.pl/~lason/SFP/TRX100007/SCP6Gx8c.pdf}

\paragraph{\textbf{Components ordered}}
\begin{itemize}
\item{3 x \ac{SFP} to SMA Adapter
(\url{https://shop.trenz-electronic.de/en/TE0422-02-SFP-2-SMA-Adapter?path=Trenz_Electronic/Accessories/SFP/TE0422/REV02})}
\item{4 x SMA cables
(\url{https://www.thorlabs.com/thorproduct.cfm?partnumber=CA2912})}
\item{2 x Gigabit ethernet media converters - for the power supplies mainly.
(\url{https://www.amazon.com/TP-Link-Ethernet-Converter-Supporting-MC220L/dp/B003CFATL0})}
\end{itemize}

\section{Development - 03/04/2019}
The aim is firstly to study how the signalling works for the \ac{SFP}
modules. These are already available inside the KORUZA modules. The modules
were taken from the control laboratory, from Ibrahima
(\href{mailto:ibrahima.ndoye@kaust.edu.sa}{ibrahima.ndoye@kaust.edu.sa}).

Two KORUZA systems have been dismantled and I have removed the following
components:

\paragraph{\textbf{KORUZA components removed}}
\begin{itemize}
\item{TP-Link MC220L}
\item{KORUZA \ac{SFP} breakout boards. See here for circuit diagrams:
\url{https://github.com/IRNAS/KORUZA/blob/master/electronics/KORUZA_SFPextension_plug/SFPextension.PDF}
and \url{https://github.com/IRNAS/KORUZA/blob/master/electronics/KORUZA_SFPextension_socket/SFPextensionSplit.PDF}}
\item{KORUZA \ac{SFP} module}
\end{itemize}

As well as this, I also have the following:

\paragraph{\textbf{Other components used}}
\begin{itemize}
\item{Power Supply (used to power TP-Link boxes). Set to 5V, 1.4A maximum
(as each TP-Link box can draw around 0.6A)}
\item{Optical Fibre (for testing)}
\item{\ac{SFP} to Ethernet module (for testing)}
\item{Raspberry Pi (for testing)}
\item{Router}
\item{2 x Ethernet cables (between TP-Link boxes and Raspberry Pi / Router)}
\item{Oscilloscope to check signals}
\end{itemize}

The Raspberry Pi is set up as an Ethernet bridge to Wifi as described here:
\url{https://www.raspberrypi.org/documentation/configuration/wireless/access-point.md}.
In particular the section "\textbf{Using the Raspberry Pi as an access
point to share an internet connection (bridge)}".

Note I also have to do the following after following the instructions
\begin{lstlisting}
	sudo systemctl unmask hostapd
	sudo systemctl enable hostapd
	sudo systemctl start hostapd
\end{lstlisting}

\section{Development - 07/04/2019}
Note that the Raspberry Pi WiFi does not seem to be stable. Was told by previous
student that it might require an external WiFi adapter in order to function
properly. Nevertheless we're going to throw it away anyway so doesn't matter.

At first I tried to point the \ac{SFP} modules at each other but the Link was
not stable. I then tried using an optical fibre but it would not plug in
properly. Instead of this, I managed to get two \ac{SFP} to Ethernet modules
and plugged then into each TP-Link box. This was enough to allow the Link
to be set up.

If the infra-red \ac{SFP} modules are aligned properly, the link is stable.
I am seeing some packet loss though this may be because the link isn't aligned
as perfectly as it could be (it's just on the table with no proper optical
alignment).

Next steps are to measure the signals (TX / RX differential ones) that go over
the SATA connector to the external \ac{SFP} cage. From this we can then
determine that the \ac{SFP} module can be pretty basic and we can just attach
our laser / photodiode. We also need to check what is in the \ac{I2C} EEPROM
memory and copy it out so that we can 'pretend' to be the same module when
we use the breakout board.

I used the Raspberry Pi that comes with Koruza as it already has the breakout
to the I2C device. This is what is in the I2C EEPROM memory, using the
following command:

\begin{lstlisting}
	i2cdump 1 0x50 i

     0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f    0123456789abcdef
00: 03 04 00 00 00 00 08 00 00 00 00 01 0d 00 00 00    ??....?....??...
10: 00 00 64 00 43 49 53 43 4f 2d 41 56 41 47 4f 20    ..d.CISCO-AVAGO 
20: 20 20 20 20 01 00 17 6a 41 42 43 55 2d 35 37 31        ?.?jABCU-571
30: 30 52 5a 2d 43 53 32 20 20 20 20 20 41 0c c1 13    0RZ-CS2     A???
40: 00 10 00 00 41 47 4d 31 32 34 35 32 32 56 35 20    .?..AGM124522V5 
50: 20 20 20 20 30 38 31 31 31 30 20 20 00 00 00 ab        081110  ...?
60: 00 00 06 11 36 c9 64 cf 43 18 00 cc 0f 1e 82 f0    ..??6?d?C?.?????
70: 80 ec 6f 00 00 00 00 00 00 00 00 00 4a af 0d b2    ??o.........J???
80: ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff    ................
90: ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff    ................
a0: ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff    ................
b0: ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff    ................
c0: ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff    ................
d0: ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff    ................
e0: ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff    ................
f0: ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff    ................

	i2cdump 1 0x56 i

     0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f    0123456789abcdef
00: 01 40 01 6d 01 41 0c c1 0c 01 c0 01 00 0f 20 01    ?@?m?A??????.? ?
10: 4c ff 0e 00 78 00 00 00 00 00 00 00 00 00 f0 00    L.?.x.........?.
20: 01 40 01 6d 01 41 0c c1 0c 01 c0 01 00 0d 20 01    ?@?m?A??????.? ?
30: 4c ff 0e 00 78 00 00 00 00 00 00 00 00 00 f0 00    L.?.x.........?.
40: 01 40 01 6d 01 41 0c c1 0c 01 c0 01 00 0d 20 01    ?@?m?A??????.? ?
50: 4c ff 0e 00 78 00 00 00 00 00 00 00 00 00 f0 00    L.?.x.........?.
60: 01 40 01 6d 01 41 0c c1 0c 01 c0 01 00 0d 20 01    ?@?m?A??????.? ?
70: 4c ff 0e 00 78 00 00 00 00 00 00 00 00 00 f0 00    L.?.x.........?.
80: 01 40 01 6d 01 41 0c c1 0c 01 c0 01 00 0d 20 01    ?@?m?A??????.? ?
90: 4c ff 0e 00 78 00 00 00 00 00 00 00 00 00 f0 00    L.?.x.........?.
a0: 01 40 01 6d 01 41 0c c1 0c 01 c0 01 00 0d 20 01    ?@?m?A??????.? ?
b0: 4c ff 0e 00 78 00 00 00 00 00 00 00 00 00 f0 00    L.?.x.........?.
c0: 01 40 01 6d 01 41 0c c1 0c 01 c0 01 00 0d 20 01    ?@?m?A??????.? ?
d0: 4c ff 0e 00 78 00 00 00 00 00 00 00 00 00 f0 00    L.?.x.........?.
e0: 01 40 01 6d 01 41 0c c1 0c 01 c0 01 00 0d 20 01    ?@?m?A??????.? ?
f0: 4c ff 0e 00 78 00 00 00 00 00 00 00 00 00 f0 00    L.?.x.........?.
\end{lstlisting}

We need to replicate this. Note the EEPROM specification is from section 8.1
in \url{http://www.kt.agh.edu.pl/~lason/SFP/TRX100007/SCP6Gx8c.pdf}.

\section{Development - 08/04/2019}
I have managed to capture some sort of signal on the differential outputs
of the SATA connection which provides the signalling to the \ac{SFP} connector.
Unfortunately the signal isn't very clean so I'm trying to make that better.

This is a useful resource about the timings:
\url{https://electronics.stackexchange.com/questions/328412/how-gigabit-ethernet-is-achieved-in-fiber-optics}

\subsection{Finding out more information about differential to single ended
conversion}
I am trying to figure out how to take the differential signals that are ouput
from the SFP connection and make them into single ended signals.
They do it here: \url{https://osmocom.org/projects/misc-hardware/wiki/Sfp-experimenter}
Also here: \url{https://github.com/aewallin/SFP2SMA_2018.03}. Looks like this
one is faster. It uses Mini-Circuits ADT2-1T transformers (see \url{https://www.minicircuits.com/pdfs/ADT2-1T.pdf}).
Note we're only using a 125Mhz clock (as 1 Gbps using 8b/10b encoding).
Maybe we should get some of these? \url{https://www.analog.com/media/en/reference-design-documentation/reference-designs/5693022520349015544867851905SFP_RDK_pra.pdf}

\section{Development - 09/04/2019}

Something interesting here (with relation to the previous Analog Devices
reference design)
\url{https://www.arrow.com/en/reference-designs/laser-driver-for-gb-ethernet-switch/6ce61f01a20a56fa532aa09927c84d22}
Another one here (this is the 10G one): \url{http://www.ti.com/tool/TIDA-00088}
And more: \url{https://www.analog.com/en/products/landing-pages/001/sfp-chipset-and-reference-design.html}.
I contacted Analog Devices to ask if we can get the reference design from them.

Current system is using the following:
\begin{itemize}
\item{Thorlabs DET10A2 Si Biased Detector}
\item{Osram 1.6 Watt Blue Laser Diode in TO56 Package}
\end{itemize}

\subsection{\ac{AGC}}
We really need to think about \ac{AGC} and how it's supposed to function. It
seems that in typical \ac{SFP} connections they control both the TX side
by utilising a photodiode in the transmitter to adjust the power; in the RX
side the RX power is adjusted too, probably by measurements.
Looks like we may need some sort of microcontroller to adjust the \ac{AGC}; this
is how it's done in other systems.

\subsection{What's in the IRNAS SFP connector}
I took apart the IRNAS SFP connector. The main chip on it is this:
\url{https://www.datasheetarchive.com/pdf/download.php?id=7a1d8924e962602762f27f57b62de6accd74e5&type=P&term=M0201x}
The suggested single ended to differential converter is M0201x. Here's an
example
\url{https://www.datasheetarchive.com/pdf/download.php?id=1450622d93878decd445ca73f09843c5b2a176&type=P&term=M02011%252F13%252F00}

It looks like we need a laser driver for the TX (\url{https://www.laserdiodecontrol.com/laser-diode-driver-basics-and-fundamentals#what-is-a-laser-diode-driver-link},
another one \url{https://www.teamwavelength.com/laser-diode-driver-basics/})
and for the RX a "Transimpedance Amplifier with AGC".

Looks like the laser is a \ac{BOSA}. Here's a typical diagram of the pins:

\begin{figure}[H]
  \includegraphics[width=0.8\textwidth]{bosa.png}
  \caption{Generic \ac{BOSA} pinout diagram}
  \label{fig:bosa}
\end{figure}
